<!doctype html>
<title>ExploRentals</title>

<head>
  <!-- Import Style Sheets -->
  <link rel="stylesheet" href="style/leaflet.css"/>
  <link rel="stylesheet" href="style/bootstrap.css"/>
  <link rel="stylesheet" href="style/style.css"/>

  <!-- External Libraries -->
  <script src="library/leaflet.js"></script>
  <script src="library/d3.js"></script>
  <script src="library/jquery.js"></script>
  <script src="library/jquery-ui.js"></script>
  <script src="library/selectize.js"></script>

  <!-- Custom Scripts -->
  <script src="layers.js"></script>
  <script src="search.js"></script>
</head>

<body>
  <!-- Layout of Search Engine -->
  <div class="container-fluid">
    <!-- Search Bar Area -->
    <div class="control-group">
      <!-- <form> -->
        <label for="select-neighborhood">Neighborhood:</label>
        <select id="select-neighborhood" placeholder="Select a neighborhood..." name="neighborhood">
          <option value="">Select a neighborhood...</option>
          <option value="1">Arlington</option>
          <option value="2">Avalon</option>
        </select>
        <button type="submit">Search</button>
      <!-- </form> -->
    </div>
    <!-- Filters -->
    <div class="row">
      <div class='search_bar'>
<<<<<<< HEAD
        <button type="button" class="btn btn-info">Price</button>
        <button type="button" class="btn btn-info">Home type</button>
        <button type="button" class="btn btn-info">Year built</button>
        <button type="button" class="btn btn-info">More Filters</button>
        <div class="slidecontainer">
          <input type="range" min="1000" max="1900" value="50" class="slider" id="myRange">
        </div>
=======
        <button type="button" class="btn btn-info" onclick="plot_hist(zillowData)">Prices</button>
>>>>>>> 6a3ae6c5895c945d56b76e9a386c8f467c01e77b
        <button type="button" class="btn btn-info" id="pop-btn">Population</button>
      </div>
    </div>
    <!-- History and Map -->
    <div id="hist_price" style="display:none;"></div>
    <div id="mapid"></div>
  </div>
</body>

<script>

let mapboxAccessToken = 'pk.eyJ1IjoiamltLXplZC1saSIsImEiOiJjamZjeGVzNzYzY3l4MndwZDJvcGhpNjF2In0.LgHQ5McMsqeSciorxS-RBw'
let geojsonFeature, censusData, zillowData;

d3.queue()
.defer(d3.csv, "./data/census_data.csv")
.defer(d3.json,"./data/allegheny_county_census_tracts_2016.geojson")
.defer(d3.csv, "./data/zillow_pittsburgh.csv")
.await(function(error, f1, f2, f3) {
  if (error) throw error;
  censusData = f1;
  geojsonFeature = f2; //geoJSON.features contain polygons
  zillowData = f3.filter(function(d) {
    return +d["Rent Amount"] > 1000;
  });

  // TODO to remove this after testing


  // parse data to their appropriate datatype before data join
  // censusData.forEach(function(e) {
  //   e.bycicle = +e.bycicle;
  //   e.car_truck_van = +e.car_truck_van;
  //   e.car_truck_van_alone = +e.car_truck_van_alone;
  //   e.car_truck_van_carpooled = +e.car_truck_van_carpooled;
  //   e.female_percent = +e.female_percent;
  //   e.male_percent = +e.male_percent;
  //   e.mean_travel_time = +e.mean_travel_time;
  //   e.median_age = +e.median_age;
  //   e.median_income = +e.median_income;
  //   e.public_transport = +e.public_transport;
  //   e.total_commute = +e.total_commute;
  //   e.total_pop = +e.total_pop;
  //   e.walked = +e.walked;
  // })
  //
  // zillowData.forEach(function(e){
  //   e.Bathroom = +e.Bathroom;
  //   e.Bedrooms = +e.Bedrooms;
  //   e["Finished Size (Sq.Ft.)"] = +e["Finished Size (Sq.Ft.)"];
  //   e["Last Sold Date"] = new Date(e["Last Sold Date"]);
  //   e["Last Sold Price"] = +e["Last Sold Price"];
  //   e["Lot Size (Sq.Ft.)"] = +e["Lot Size (Sq.Ft.)"];
  //   e["Months Since Last Sold"] = +e["Months Since Last Sold"];
  //   e["Rent Amount"] = +e["Rent Amount"];
  //   e["Rent Amt 1-Week Change"] = +e["Rent Amt 1-Week Change"];
  //   e["Rent Amt Maximum"] = +e["Rent Amt Maximum"];
  //   e["Rent-to-Finished Size Ratio"] = +e["Rent-to-Finished Size Ratio"];
  //   e["Sale Amount"] = +e["Sale Amount"];
  //   e["Sale Amt 1-Week Change"] = +e["Sale Amt 1-Week Change"];
  //   e["Sale Amt Maximum"] = +e["Sale Amt Maximum"];
  //   e["Sale Amt Minimum"] = +e["Sale Amt Minimum"];
  //   e["Sale-to-Finished Size Ratio"] = +e["Sale-to-Finished Size Ratio"];
  //   e["Sale-to-Rent Ratio"] = +e["Sale-to-Rent Ratio"];
  //   e["Tax Assessment Amt"] = +e["Tax Assessment Amt"];
  //   e["Tax Assessment Year"] = +e["Tax Assessment Year"];
  //   e["Total Rooms"] = +e["Total Rooms"];
  //   e["Year Built"] = +e["Year Built"];
  // })

  geojsonFeature.features.forEach(function(row) {
    // ensure no missing value from census tract id
    let result = censusData.filter(function(entry) {
      return entry.tract === row.properties.TRACTCE;
    });
    // append census data to geoJSON feature.properties
    row.properties.census = (result[0] !== undefined) ? result[0] : null;
  })



  // lay out base map layout
  let map = L.map('mapid').setView([40.4406, -79.9959], 12);
  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
      maxZoom: 15,
      minZoom: 12,
      zoomSnap: 0.2,
      id: 'mapbox.streets',
      accessToken: mapboxAccessToken
  }).addTo(map);

  d3.select("#pop-btn")
    .on("click", function() {
      showPopMapLayer(geojsonFeature, map);
      // TODO: Include a remove_dots function
      // need to call show_houses again so dots are on top of map
      show_houses(zillowData, map);
    });

  show_houses(zillowData, map);
  filter_by_prices(zillowData, 1000);

  // selectize implementation
  let $select = $('#select-neighborhood').selectize({
    sortField: {
      field: 'text',
      direction: 'asc',
      dropdownParent: 'body'
    }
  });

<<<<<<< HEAD
});
=======
  let selectizeControl = $select[0].selectize

  selectizeControl.on('change', function() {
    let test = selectize.getValue();
    alert(test);
  })

  // hist graph with brush
  var svg = d3.select('#hist_price')
  .append('svg')
  .attr('width', 400)
  .attr('height', 200)
  .attr('class', 'svg_price');

}); //end of d3.queue
>>>>>>> 6a3ae6c5895c945d56b76e9a386c8f467c01e77b

</script>
